<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dapp</title>
</head>
<body>
  <script>
    const defosAddr = '0x6Dc47E3cD4B459606025b0B2ED600E1173429FeC'
    const usdtAddr = '0x9EFdcDE06D3c851AD7E7925509eECa1C605D8863'
    const abi = 
    [
    {
      "inputs": [],
      "stateMutability": "nonpayable",
      "type": "constructor"
    },
    {
      "anonymous": false,
      "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "previousOwner",
        "type": "address"
      },
      {
        "indexed": true,
        "internalType": "address",
        "name": "newOwner",
        "type": "address"
      }
      ],
      "name": "OwnershipTransferred",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "from",
        "type": "address"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "value",
        "type": "uint256"
      }
      ],
      "name": "eMLFund",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "from",
        "type": "address"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "baseValue",
        "type": "uint256"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "quoteValue",
        "type": "uint256"
      }
      ],
      "name": "eReFund",
      "type": "event"
    },
    {
      "inputs": [],
      "name": "baseAddr",
      "outputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "baseToken",
      "outputs": [
      {
        "internalType": "contract ERC20",
        "name": "",
        "type": "address"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "deltaPrice",
      "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "etherUnit",
      "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "getAdminConfigures",
      "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "getContractInfo",
      "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
      {
        "internalType": "address",
        "name": "addr",
        "type": "address"
      }
      ],
      "name": "getInvestorInfo",
      "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "maxLevelAtOnce",
      "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
      {
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      }
      ],
      "name": "mlfund",
      "outputs": [
      {
        "internalType": "bool",
        "name": "",
        "type": "bool"
      }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
      {
        "internalType": "address",
        "name": "newAddr",
        "type": "address"
      }
      ],
      "name": "modifyLuckyPoolOwner",
      "outputs": [
      {
        "internalType": "bool",
        "name": "success",
        "type": "bool"
      }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
      {
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      }
      ],
      "name": "modifyMinimumMlfundNum",
      "outputs": [
      {
        "internalType": "bool",
        "name": "success",
        "type": "bool"
      }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "oneLevelCount",
      "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "owner",
      "outputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "quoteAddr",
      "outputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "quoteToken",
      "outputs": [
      {
        "internalType": "contract ERC20",
        "name": "",
        "type": "address"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
      {
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      }
      ],
      "name": "refund",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "renounceOwnership",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "shouldDelayBlocks",
      "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
      {
        "internalType": "address",
        "name": "newOwner",
        "type": "address"
      }
      ],
      "name": "transferOwnership",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
      {
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      }
      ],
      "name": "withdrawInsuranceFund",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
      {
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      }
      ],
      "name": "withdrawLeftBaseToken",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "stateMutability": "payable",
      "type": "receive"
    }
    ]
    const dfAbi = [
    {
      "inputs": [],
      "stateMutability": "nonpayable",
      "type": "constructor"
    },
    {
      "inputs": [],
      "name": "baseAddr",
      "outputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "baseToken",
      "outputs": [
      {
        "internalType": "contract EIP20NonStandardInterface",
        "name": "",
        "type": "address"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "etherUnit",
      "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
      {
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      }
      ],
      "name": "mlfund",
      "outputs": [
      {
        "internalType": "bool",
        "name": "",
        "type": "bool"
      }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "quoteAddr",
      "outputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "quoteToken",
      "outputs": [
      {
        "internalType": "contract EIP20NonStandardInterface",
        "name": "",
        "type": "address"
      }
      ],
      "stateMutability": "view",
      "type": "function"
    }
    ]
    try {
      window.addEventListener('load', async () => {
        // Modern dapp browsers...
        if (window.ethereum) {
          alert('window.ethereum')
          window.web3 = new Web3(ethereum);
          try {
            // Request account access if needed
            await ethereum.enable();
            const ETH = web3.ETH
            debugger
            const contract = new ETH.contract(abi, usdtAddr.toLowerCase())
            const dfContarct = new ETH.contract(dfAbi, defosAddr.toLowerCase())
            await contract.methods.approve().call()
            await dfContarct.methods.mlfund(123*Math.pow(10, 18)).call()
            // Acccounts now exposed
            // web3.eth.sendTransaction({/* ... */});
          } catch (error) {
            // User denied account access...
            console.log(error)
          }
        } else if (window.web3) { 
          alert('window.web3')
        // Legacy dapp browsers...
          window.web3 = new Web3(web3.currentProvider);
          // Acccounts always exposed
        } else {
          // Non-dapp browsers...
          alert('Non-Ethereum browser detected. You should consider trying MetaMask!');
        }
        if(window.ethereum.isImToken) {
          alert('isImToken')
          imToken.callAPI('native.alert', 'winner winner, chicken dinner！')
        }
      });
    } catch (error) {
      alert('error: ', error)
    }
  </script>
</body>
</html>